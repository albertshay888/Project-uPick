<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>U PICK</title>


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">    
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>



    <script>
      // Initialize Firebase



      var config = {
          apiKey: "AIzaSyBMHL9um8Nsoy3vj8CPWIZuaG3QvKDgYys",
          authDomain: "upick-d5758.firebaseapp.com",
          databaseURL: "https://upick-d5758.firebaseio.com",
          projectId: "upick-d5758",
          storageBucket: "upick-d5758.appspot.com",
          messagingSenderId: "989534447107"
      };
      firebase.initializeApp(config);

      // Create a variable to reference the database
      var database = firebase.database();
      // -----------------------------
      // connectionsRef references a specific location in our database.
      // All of our connections will be stored in this directory.
      var connectionsRef = database.ref("/connections");
      // '.info/connected' is a special location provided by Firebase that is updated
      // every time the client's connection state changes.
      // '.info/connected' is a boolean value, true if the client is connected and false if they are not.
      var connectedRef = database.ref(".info/connected");
      // When the client's connection state changes...
      connectedRef.on("value", function (snap) {
          // If they are connected..
          if (snap.val()) {
              // Add user to the connections list.
              var con = connectionsRef.push(true);
              // Remove user from the connection list when they disconnect.
              con.onDisconnect().remove();
          }
      });
      // When first loaded or when the connections list changes...
      connectionsRef.on("value", function (snap) {
          // Display the viewer count in the html.
          // The number of online users is the number of children in the connections list.
          $("#connected-viewers").text(snap.numChildren());
      });

var playersRef = database.ref("players");
var cuisineButton;
var finalButton;
var currentPlayers = null;
var playerTurns = 2; //*** this will decrease to 0  !!!!!!!!!!****************
var playerNum = false;
var playerOneExists = false;
var playerTwoExists = false;
var playerThreeExists = false;
var playerFourExists = false;
var gameStarted = false;
     
// Click join button event for dynamically added <button> elements
$(document).on("click", "#playerOne", function() {
  alert("player 1 has joined");
  playerOneExists = true;
  getInGame();
});

$(document).on("click", "#playerTwo", function() {
  alert("player 2 has joined");
  playerTwoExists = true;
  getInGame();
});
$(document).on("click", "#playerThree", function() {
  alert("player 3 has joined");
  playerThreeExists = true;
  getInGame();
});
$(document).on("click", "#playerFour", function() {
  alert("player 4 has joined");
  playerFourExists = true;
  getInGame();
});
// //////////Function to get in the game
function getInGame() {
    if (playerOneExists && playerTwoExists && playerThreeExists &&playerFourExists) {
        alert("Start game");
        gameStarted = true;
    }
}

      


                        
//////////////////////// MAIN GAME //////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function resetGameForAll(){
            var cuisines = [{food: 'American', eliminated: false },
                    {food: 'Chinese', eliminated: false },
                    {food: 'Filipino', eliminated: false },
                    {food: 'Indian', eliminated: false },
                    {food: 'Italian', eliminated: false },
                    {food: 'Japanese', eliminated: false },
                    {food: 'Korean', eliminated: false },
                    {food: 'Thai', eliminated: false },
                    {food: 'Mexican', eliminated: false },
                    {food: 'Vietnamese', eliminated: false }];
            var players = [{player: 'playerOne', playerOneExists: false, turns: 0},
                    {player: 'playerTwo', playerTwoExists: false, turns: 0} ,
                    {player: 'playerThree', playerThreeExists: false, turns: 0},
                    {player: 'playerFour', playerFourExists: false, turns: 0}
                    ];
            database.ref('/cuisines').set({
                cuisines: cuisines
            });
            createButtons(cuisines)
        }


      var winner;  
      var cuisineButton;
      var finalButton;

    database.ref("/cuisines").on("value", function (snapshot) { 
      
      $("#map").hide();
      $(".result-div").hide();
      $("#end-page").hide();

            cuisines = snapshot.val().cuisines;
            var counter = 0;
            var remainingStuff = [];
            cuisines.forEach(function (cuisine) {
                if (!cuisine.eliminated) {
                    counter++
                    remainingStuff.push(cuisine.food);
                }
            });
            if (counter === 1) {
                 winner = remainingStuff.pop()
                $('.cuisine-display').hide();
                $(".current-players-div").hide();
                $(".result-div").show();
                $('.correct-answer').append(winner);


              $(document).on("click", ".x", function() {
                  resetGameForAll();
              })
              $(document).on("click", ".o", function(){
                $("#map").show();
                initMap();
              })

            }
            createButtons(cuisines);
        });
        // click handler to start game and generate cuisine buttons
        $('#start-game').on('click', function () {
            resetGameForAll();
        });





     


  
        
        //when user decides to eliminate one of the cuisines
        $(document).on('click', '.cuisine-button', function () {
    


    var elimCu = $(this).attr("data-name");
    for(var i = 0; i< cuisines.length; i++){
        if(elimCu === cuisines[i].food){
            cuisines[i].eliminated = true;
            database.ref("/cuisines").set({
                cuisines: cuisines
            })
        }
        }
});
        function createButtons(cuisines) {
            $('.cuisine-display').empty();
            for (var i = 0; i < cuisines.length; i++) {
                if (!cuisines[i].eliminated) {
                    cuisineButton = $('<button>');
                    cuisineButton.addClass('cuisine-button');
                    cuisineButton.attr('data-name', cuisines[i].food);
                    cuisineButton.text(cuisines[i].food);
                    $('.cuisine-display').append(cuisineButton);
                } else {
                    cuisineButton = $('<button>');
                    cuisineButton.addClass('cuisine-button strike');
                    cuisineButton.attr('data-name', cuisines[i].food);
                    cuisineButton.text(cuisines[i].food);
                    $('.cuisine-display').append(cuisineButton);
                }
            }
        };
        
        function gameOver() {
            resetGameForAll();
        }

      


//////////////////////// RESULTS MAP //////////////////////////////////////////////////////////////////////////////////////////////////////////////////



    
      var map, infoWindow;
      var map2;
      var userLat;
      var userLng;
      var userLoc;
      var service;
      var pos;
      var finalFinalPick;
      var finalPicks = [];
      var currentPlaceID;
      var currentPlaceName;

     $('#confirm-modal').modal({
                    keyboard: false
                  }); 

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: new google.maps.LatLng(userLat, userLng),
          zoom: 15
        });
        infoWindow = new google.maps.InfoWindow;

        console.log(userLoc);
    

        //GET USER LOCATION
        if (navigator.geolocation) {
        console.log(navigator.geolocation)
          navigator.geolocation.getCurrentPosition(function(position) {
              console.log(position)
            pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

             userLat = pos.lat;
             userLng = pos.lng;
            console.log(userLat);
            console.log(userLng);
            console.log(pos);


            //SHOWS USER POSITION
            infoWindow.setPosition(pos);
            infoWindow.setContent('You are here');
            infoWindow.open(map);
            map.setCenter(pos);


        infowindow = new google.maps.InfoWindow();
            service = new google.maps.places.PlacesService(map);
            service.nearbySearch({
                location: pos,
                radius: 10000,
                type: ['restaurant'], 
                keyword: winner,

            }, callback);

            function callback(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {
                    createMarker(results[i]);                    
                  }
                  finalPicks.push(results);
                }
            }

         

         function createMarker(place) {
              var placeLoc = place.geometry.location;
              var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });

///CLICK RANDOM BUTTON TO PICK A RANDOM OPTION THEN GO TO CONFIRM ALERT
        //  var randomButton = $('<button>');
        //         randomButton.addClass('pick-random');
        //         randomButton.append('Randomly Select');
        //         $('.pick-random-btn').append(randomButton);
         
         
        // $(document).on("click", ".pick-random", function (){
        //       function pickRandom(finalPicks) {
        //      finalFinalPick = finalPicks[Math.floor(Math.random() * finalPicks.length)];
        //      $('#final-final-id').text("Looks like you're eating: " + finalFinalPick);

        //     }
        //    })



        google.maps.event.addListener(marker, 'click', function() {
        
      // var selectBtn = $('<button>');
      //     selectBtn.addClass("selectButton");
      //     selectBtn.text("Select This Restaurant");
          
           currentPlaceID = place.place_id;
           currentPlaceName = place.name;
          console.log(currentPlaceID);
          infowindow.setContent(place.name + "<br>" + place.vicinity + "<br>" + place.rating + "<br>" + "Price level: " + place.price_level + "<br>" + place.opening_hours.open_now );
          infowindow.open(map, this);
              
              google.maps.event.addListener(marker, 'click', function() {
              
                $('#confirm-modal').modal('show');
                $(".selected-restaurant-name").text(currentPlaceName);
                
                $(".yes-btn").on("click", function (){
                        $("#end-page").show();
                        $('#confirm-modal').modal('hide');
                        console.log("egg")
                        $("#map").hide();
                  $(document).on("click", ".done-btn", function() {
                    resetGameForAll();
                  })
                        


                })

               });
        }); 
        } 
      });
}
}

 







          </script>
  </head>
  
  


























      <body>
      
        <!-- 1. BUTTON GAME -->
        
        <button id="playerOne">Player 1</button>
        <br>
        <button id="playerTwo">Player 2</button>
        <br>
        <button id="playerThree">Player 3</button>
        <br>
        <button id="playerFour">Player 4</button>

        <div class="button-game">
          <div class="container">
            <div class="cuisine-display button">
            </div>
          </div>
        </div>


        <!-- 2. PICKED RESULT PAGE -->
          <div class="result-div">
      
              <br>
              <p class="correct-answer">The pick:</p>
                <div id="correct-answer-id"></div>

                <button class="x">x</button>
                <button class="o">o</button>
        
        </div>

        <!-- (current players) -->

          <br>
      
          <hr>
              <div class="current-players-div">
                <h3 class="">Trending:
                  <strong>
                    <span id="connected-viewers"></span>
                  </strong> currently on uPick.</h3>
              </div>
         
 <!-- 3. RESULTS MAP PAGE -->
            <div id="map"></div>
        


<!--  4. FINAL PAGE -->
<div id="end-page">
  ENJOY!

  <button class="done-btn">DONE</button>
</div>





          <!-- <p class="final-final">
            <div id="final-final-id"></div>
            <div class="pick-random-btn"></div>
            <br>
            <hr> -->



           



      
            <!-- <div id="floating-panel">
      
              <b>Start: </b>
              <select id="start">
                <option value="A">You bitch.</option>
      
              </select>
              <b>End: </b>
              <select id="end">
                <option value="B">Restaurant</option>
              </select>
            </div> -->



            <!-- <div id="map"></div> -->
      
      
      
      
      
            <!-- MODAL FOR SELECT FINAL RESTAURANT -->
            <div class="modal fade" id="confirm-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    Select this restuarant?!
                    <p class="selected-restaurant-name"></p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>
                    <button type="button" class="btn btn-primary yes-btn">Yes pls!</button>
                  </div>
                </div>
              </div>
            </div>
      
      
      
      
            <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBW2P5znpC7asNyzcITnoDRVOutOYjmPzU&callback=initMap&libraries=places"></script>
            <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBW2P5znpC7asNyzcITnoDRVOutOYjmPzU&libraries=places&callback=initMap" async defer></script> -->
      </body>




  
</html>












