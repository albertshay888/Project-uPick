<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>uPick</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
</head>
<body>
    <button id="start-game">Start Game</button>
    <div class="container">
        <div class="row">
            <div class="cuisine-display" class="button">
            </div>
        </div>
    </div>
    <br>
    <p class="correct-answer">The pick:
            <div class="correct-answer" id="correct-answer-id"></div>
            <br>
            
            <hr>
            <div>
            <h3 class="">Trending:
              <strong>
                <span id="connected-viewers"></span>
              </strong> currently on uPick.</h3>
            </div>
       
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>

<script>
// Initialize Firebase
      var config = {
        apiKey: "AIzaSyBMHL9um8Nsoy3vj8CPWIZuaG3QvKDgYys",
        authDomain: "upick-d5758.firebaseapp.com",
        databaseURL: "https://upick-d5758.firebaseio.com",
        projectId: "upick-d5758",
        storageBucket: "upick-d5758.appspot.com",
        messagingSenderId: "989534447107"
      };

      firebase.initializeApp(config);

      // Create a variable to reference the database

       var database = firebase.database();    

       // -----------------------------

// connectionsRef references a specific location in our database.
// All of our connections will be stored in this directory.
var connectionsRef = database.ref("/connections");

// '.info/connected' is a special location provided by Firebase that is updated
// every time the client's connection state changes.
// '.info/connected' is a boolean value, true if the client is connected and false if they are not.
var connectedRef = database.ref(".info/connected");

// When the client's connection state changes...
connectedRef.on("value", function(snap) {

  // If they are connected..
  if (snap.val()) {

    // Add user to the connections list.
    var con = connectionsRef.push(true);
    // Remove user from the connection list when they disconnect.
    con.onDisconnect().remove();
  }
});

// When first loaded or when the connections list changes...
connectionsRef.on("value", function(snap) {

  // Display the viewer count in the html.
  // The number of online users is the number of children in the connections list.
  $("#connected-viewers").text(snap.numChildren());
});
    


    // Initital values: list of top trending cuisines
     var cuisines = ['American', 'Chinese', 'Filipino','Indian', 'Italian', 'Japanese', 'Korean', 'Thai', 'Mexican', 'Vitnamese'];
     var cuisineButton;
     var finalButton;
     database.ref("/cuisines").set({
         cuisines: cuisines
     })

     // At the initial load and subsequent value changes, get a snapshot of the stored data.
     // Th
     database.ref("/cuisines").on("value", function(snapshot) {
         if(cuisines.length === 10){
             return;
         }
    // If Firebase has a highPrice and highBidder stored, update our client-side variables
    // if (snapshot.("cuisines").exists()) {
    // Set the variables for cuisines equal to the stored values.
        cuisines = snapshot.val().cuisines;
        // highPrice = parseInt(snapshot.val().highPrice);
        createButtons(cuisines);
 
  

    // If Firebase does not have highPrice and highBidder values stored, they remain the same as the
    // values we set when we initialized the variables.
    // In either case, we want to log the values to console and display them on the page.

  // If any errors are experienced, log them to console.
//   }, function(errorObject) {
//        console.log("The read failed: " + errorObject.code);
  }); 



// click handler to start game and generate cuisine buttons
$('#start-game').on('click', function () {
    // event.preventDefault();
    cuisines = ['Korean', 'Japanese', 'Filipino', 'Chinese', 'Mexican', 'Burmese', 'Thai', 'American', 'Indian', 'Italian'];
    database.ref('/cuisines').set({
        cuisines: cuisines
    })
    // console.log("button clicked!");
    createButtons(cuisines)

});

//when user decides to eliminate one of the cusines
$(document).on('click', '.cuisine-button', function () {

    
    var elimCu = $(this).attr("data-name");
    // debugger
    for(var i = 0; i< cuisines.length; i++){
    if(elimCu === cuisines[i]){
        cuisines.splice(i, 1);
        // createButtons(cuisines);
        database.ref("/cuisines").set({
            cuisines: cuisines
        })

    }

}
});

//functionality to delete cuisine-selections 
function createButtons(cuisines){
    // however game ends when all but 1 selections are eliminated
    if(cuisines.length === 1) {
        finalButton = $('p').text(cuisines);
        $('p').append(finalButton);   
        alert(`The picked cuisine is: ${cuisines}`);
    }
    
    
    //to delete cuisine-selection
    $('.cuisine-display').empty();
    for (var i = 0; i < cuisines.length; i++) {
        cuisineButton = $('<button>');
        cuisineButton.addClass('cuisine-button');
        cuisineButton.attr('data-name', cuisines[i]);
        
        cuisineButton.text(cuisines[i]);
        
        $('.cuisine-display').append(cuisineButton);
        
        
     
        
    } 
};


</script>
</body>
</html>
