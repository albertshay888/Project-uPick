<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>uPick</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <style>
        .strike {
            color: red;
        }
    </style>
</head>
<body>
    
    <div class="container">
        <div class="row">
            <div class="cuisine-display button">
            </div>
        </div>
    </div>
    <br>
    <p class="correct-answer">The pick:
            <div class="correct-answer" id="correct-answer-id"></div>
            <br>
            
            <hr>
            <div>
            <h3 class="">Trending:
              <strong>
                <span id="connected-viewers"></span>
              </strong> currently on uPick.</h3>
            </div>
            
                <button id="playerOne">Player 1</button>
                <br>
                <button id="playerTwo">Player 2</button>
                <br>
                <button id="playerThree">Player 3</button>
                <br>
                <button id="playerFour">Player 4</button>
            
       
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>

<script>
// Initialize Firebase
var config = {
    apiKey: "AIzaSyAV-grm0Ao9DBqUZT6mCgIxD4nA1oM0NCE",
    authDomain: "testproject-ecfdb.firebaseapp.com",
    databaseURL: "https://testproject-ecfdb.firebaseio.com",
    projectId: "testproject-ecfdb",
    storageBucket: "testproject-ecfdb.appspot.com",
    messagingSenderId: "1009715215096"
  };
  firebase.initializeApp(config);

      // Create a variable to reference the database

       var database = firebase.database();    

       // -----------------------------

// connectionsRef references a specific location in our database.
// All of our connections will be stored in this directory.
var connectionsRef = database.ref("/connections");


// '.info/connected' is a special location provided by Firebase that is updated
// every time the client's connection state changes.
// '.info/connected' is a boolean value, true if the client is connected and false if they are not.
var connectedRef = database.ref(".info/connected");

// When the client's connection state changes...
connectedRef.on("value", function(snap) {

  // If they are connected..
  if (snap.val()) {

    // Add user to the connections list.
    var con = connectionsRef.push(true);
    // Remove user from the connection list when they disconnect.
    con.onDisconnect().remove();
  }
});

// When first loaded or when the connections list changes...
connectionsRef.on("value", function(snap) {

  // Display the viewer count in the html.
  // The number of online users is the number of children in the connections list.
  $("#connected-viewers").text(snap.numChildren());
});
    
// var cuisines = [{food: 'American', eliminated: false },
//                 {food: 'Chinese', eliminated: false },
//                 {food: 'Filipino', eliminated: false },
//                 {food: 'Indian', eliminated: false },
//                 {food: 'Italian', eliminated: false },
//                 {food: 'Japanese', eliminated: false },
//                 {food: 'Korean', eliminated: false },
//                 {food: 'Thai', eliminated: false },
//                 {food: 'Mexican', eliminated: false },
//                 {food: 'Vietnamese', eliminated: false }]
var playersRef = database.ref("players");
var cuisineButton;
var finalButton;
var currentPlayers = null;
var playerTurns = 2; //*** this will decrease to 0  !!!!!!!!!!****************
var playerNum = false;
var playerOneExists = false;
var playerTwoExists = false;
var playerThreeExists = false;
var playerFourExists = false;
var gameStarted = false;
     
// Click join button event for dynamically added <button> elements
$("#playerOne").on("click", function() {
  alert("player 1 has joined");
  playerOneExists = true;
  getInGame();
});

$("#playerTwo").on("click", function() {
  alert("player 2 has joined");
  playerTwoExists = true;
  getInGame();
});

$("#playerThree").on("click", function() {
  alert("player 3 has joined");
  playerThreeExists = true;
  getInGame();
});

$("#playerFour").on("click", function() {
  alert("player 4 has joined");
  playerFourExists = true;
  getInGame();
});

// //////////Function to get in the game
function getInGame() {
    if (playerOneExists && playerTwoExists && playerThreeExists &&playerFourExists) {
        alert("Start game");
        gameStarted = true;
    }
}



///////when all but 1 are eliminated game ends
database.ref("/cuisines").on("value", function(snapshot) {
    cuisines = snapshot.val().cuisines;
    var counter = 0;
    var remainingStuff = [];
    cuisines.forEach(function(cuisine){ 
        if(!cuisine.eliminated){
            counter++
            remainingStuff.push(cuisine.food);
        } 
    });
    if(counter === 1){
        var winner = remainingStuff.pop()
        alert("We have a winner! We gettin' " + winner + " food tonight!!" )
        gameOver();
    }
    createButtons(cuisines);
}); 

// click handler to start game and generate cuisine buttons
$('#start-game').on('click', function () {
    resetGameForAll();
});

function resetGameForAll(){
    var cuisines = [{food: 'American', eliminated: false },
                    {food: 'Chinese', eliminated: false },
                    {food: 'Greek', eliminated: false },
                    {food: 'Indian', eliminated: false },
                    {food: 'Italian', eliminated: false },
                    {food: 'Japanese', eliminated: false },
                    {food: 'Korean', eliminated: false },
                    {food: 'Mexican', eliminated: false },
                    {food: 'Vietnamese', eliminated: false },
                
                    ];
     var players = [{player: 'playerOne', playerOneExists: false, turns: 0},
                    {player: 'playerTwo', playerTwoExists: false, turns: 0} ,
                    {player: 'playerThree', playerThreeExists: false, turns: 0},
                    {player: 'playerFour', playerFourExists: false, turns: 0}
                    ];
                     

    database.ref('/cuisines').set({
        cuisines: cuisines
    });
    createButtons(cuisines)
}

//////when user decides to eliminate one of the cusines
$(document).on('click', '.cuisine-button', function () {
    if (!gameStarted) {
        alert("waiting for remaining players to join");
    } else {
    var elimCu = $(this).attr("data-name");
    for(var i = 0; i< cuisines.length; i++){
        if(elimCu === cuisines[i].food){
            cuisines[i].eliminated = true;
            database.ref("/cuisines").set({
                cuisines: cuisines
            })
        }
        }
    }
});


function createButtons(cuisines){
    $('.cuisine-display').empty();
    for (var i = 0; i < cuisines.length; i++) {
        if(!cuisines[i].eliminated){
            cuisineButton = $('<button>');
            cuisineButton.addClass('cuisine-button');
            cuisineButton.attr('data-name', cuisines[i].food);
            cuisineButton.text(cuisines[i].food);
        $('.cuisine-display').append(cuisineButton);
        } else {
            cuisineButton = $('<button>');
            cuisineButton.addClass('cuisine-button strike');
            cuisineButton.attr('data-name', cuisines[i].food);
            cuisineButton.text(cuisines[i].food);
            $('.cuisine-display').append(cuisineButton);
        }
    } 
};

function gameOver(){
    resetGameForAll();
}


</script>
</body>
</html>
